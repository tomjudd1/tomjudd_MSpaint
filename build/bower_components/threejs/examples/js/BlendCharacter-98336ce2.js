THREE.BlendCharacter=function(){this.animations={},this.weightSchedule=[],this.warpSchedule=[],this.load=function(t,i){var e=this,a=new THREE.JSONLoader;a.load(t,function(t,a){var n=a[0];n.skinning=!0,THREE.SkinnedMesh.call(e,t,n);for(var s=0;s<t.animations.length;++s){var h=t.animations[s].name;e.animations[h]=new THREE.Animation(e,t.animations[s])}e.skeletonHelper=new THREE.SkeletonHelper(e),e.skeletonHelper.material.linewidth=3,e.add(e.skeletonHelper),e.showSkeleton(!1),void 0!==i&&i()})},this.update=function(t){for(var i=this.weightSchedule.length-1;i>=0;--i){var e=this.weightSchedule[i];e.timeElapsed+=t,e.timeElapsed>e.duration?(e.anim.weight=e.endWeight,this.weightSchedule.splice(i,1),0==e.anim.weight&&e.anim.stop(0)):e.anim.weight=e.startWeight+(e.endWeight-e.startWeight)*e.timeElapsed/e.duration}this.updateWarps(t),this.skeletonHelper.update()},this.updateWarps=function(t){for(var i=this.warpSchedule.length-1;i>=0;--i){var e=this.warpSchedule[i];if(e.timeElapsed+=t,e.timeElapsed>e.duration)e.to.weight=1,e.to.timeScale=1,e.from.weight=0,e.from.timeScale=1,e.from.stop(0),this.warpSchedule.splice(i,1);else{var a=e.timeElapsed/e.duration,n=e.from.data.length,s=e.to.data.length,h=n/s,o=s/n;e.from.timeScale=1-a+h*a,e.to.timeScale=a+o*(1-a),e.from.weight=1-a,e.to.weight=a}}},this.play=function(t,i){this.animations[t].play(0,i)},this.crossfade=function(t,i,e){var a=this.animations[t],n=this.animations[i];a.play(0,1),n.play(0,0),this.weightSchedule.push({anim:a,startWeight:1,endWeight:0,timeElapsed:0,duration:e}),this.weightSchedule.push({anim:n,startWeight:0,endWeight:1,timeElapsed:0,duration:e})},this.warp=function(t,i,e){var a=this.animations[t],n=this.animations[i];a.play(0,1),n.play(0,0),this.warpSchedule.push({from:a,to:n,timeElapsed:0,duration:e})},this.applyWeight=function(t,i){this.animations[t].weight=i},this.pauseAll=function(){for(var t in this.animations)this.animations[t].isPlaying&&this.animations[t].stop()},this.unPauseAll=function(){for(var t in this.animations)this.animations[t].isPlaying&&this.animations[t].isPaused&&this.animations[t].pause()},this.stopAll=function(){for(a in this.animations)this.animations[a].isPlaying&&this.animations[a].stop(0),this.animations[a].weight=0;this.weightSchedule.length=0,this.warpSchedule.length=0},this.showSkeleton=function(t){this.skeletonHelper.visible=t},this.showModel=function(t){this.visible=t}},THREE.BlendCharacter.prototype=Object.create(THREE.SkinnedMesh.prototype),THREE.BlendCharacter.prototype.constructor=THREE.BlendCharacter,THREE.BlendCharacter.prototype.getForward=function(){var t=new THREE.Vector3;return function(){return t.set(-this.matrix.elements[8],-this.matrix.elements[9],-this.matrix.elements[10]),t}};