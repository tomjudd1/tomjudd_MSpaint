"use strict";function u(n){if(this.U=[],this.r=[],this.X=[],this.L=0,this.F=[],this.R=[],this.T=[],n)for(var t=0,r=n.length;r>t;t++){var e=w(this,n[t]);if(3>e.length)console.log("Polygon has < 3 vertices!",e);else{for(var i=void 0,l=void 0,o=void 0,a=0;a<e.length-1;a++)i=x(this,e[a],e[a+1]),o?(i.o=o,o.m=i):l=i,o=i,this.r.push(i);i=x(this,e[e.length-1],e[0]),i.o=o,o.m=i,this.r.push(i),l.o=i,i.m=l,this.F[this.L++]=!0}}}function B(n,t,r,e){n.T.push([t.id,r.id,e.id])}function w(n,t){function e(n,t){return Math.abs(n.x-t.x)<r.c.n&&Math.abs(n.y-t.y)<r.c.n}function i(n,t,e){if(Math.abs(r.c.N(t,n,e))>r.c.n)return!1;var i;return Math.abs(n.y-t.y)<r.c.n?(i=t.x,n.x<e.x?(t=n.x,n=e.x):(t=e.x,n=n.x)):(i=t.y,n.y<e.y?(t=n.y,n=e.y):(t=e.y,n=n.y)),t-i<r.c.n&&i-n<r.c.n}for(var l,o,a,f=[],h=0;h<t.length;h++)l=D(n,t[h].x,t[h].y),o=!0,a=f.length-1,a>=0&&(e(l,f[a])?o=!1:a>0&&i(f[a-1],f[a],l)&&f.pop()),o&&f.push(l);return a=f.length-1,a>0&&e(f[a],f[0])&&(f.pop(),a--),a>1&&(i(f[a-1],f[a],f[0])&&(f.pop(),a--),a>1&&i(f[a],f[0],f[1])&&f.shift()),f}function x(n,t,e){return{O:n.L,a:t,i:e,p:1==r.c.G(e,t),o:null,m:null,H:null,I:null,v:!1,J:null,K:null,j:null,g:null,w:!1}}function D(n,t,r){return t={id:n.U.length,x:t,y:r},n.U.push(t),t}function E(n){this.k=n}function F(n,t,r,e){this.q=n?n:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.l=t?t:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},this.t=r,this.s=e,this.depth=-1}function G(n){var t=new F(n.q,n.l,n.t,n.s);return t.e=n.e,t.f=n.f,t.b=n.b,t.d=n.d,t.u=n.u,t}function H(n){this.A=n,n.u=this}function I(n){var t=new F(null,null,null,null);if(this.B=[],J(this,t),this.root=new H(t),n)for(n=n.r,t=0;t<n.length;t++)n[t].H=n[t].I=this.root,n[t].v=!1}function L(n,t){function r(){var n=y.e||y.f;n.b&&n.d?y==n.b?(c.e=null,n.b=s):(s.f=null,n.d=c):(c.e=null,c.f=n,n.d=c)}function e(n){y.l==p.l?(a?y.b?(n.e=s,s.b=n,c.d=null):(n.f=c,s.b=null,c.d=n):(n.e=s,n.f=c,s.b=c.d=n),s.d=c.b=null):(n.e&&n.f&&(n.e==y?(n.C=n.f,n.ba=!0):(n.C=n.e,n.ba=!1)),n.e=s,n.f=c,s.d=c.b=n,s.b=c.d=null)}function i(){var n;if(y.l==p.l&&a)y.b.e=s,y.d.f=c,s.b=y.b,c.d=y.d,n=s.d=c.b=null;else{y.b.e=s,y.d.f=c;var r=M(t,y.l);if(r>0)n=!0;else if(0>r)n=!1;else{n=y.b.s;var e=n.p,r=e?n.a:n.i,r=M(t,r);r>0?n=!0:0>r?n=!1:(n=e?n.m:n.o,r=e?n.i:n.a,r=M(t,r),n=r>0?!0:!1)}n?(n=y.d,y.d.e=s,s.b=y.b,c.d=null):(n=y.b,y.b.f=c,c.d=y.d,s.b=null),s.d=c.b=n}return n}N(t);var l,o,a,f,h,u;if(t.p?(l=t.a,f=t.i,o=t.H,h=t.I,a=t.o.v,u=t.m.v):(l=t.i,f=t.a,o=t.I,h=t.H,a=t.m.v,u=t.o.v),u||(u=O(n,h,f,!1),h==o&&(o=u),h=u),h=h.A,h.e||h.f)if(h.q!=f)console.log("ERR add_segment: trFirstHigh != segHigh: ",h);else{a||(o=O(n,o,l,!0));var s,c,g,d,p=o.A,y=h;for(l=n.B.length+2;y;){if(0>--l)return void console.log("ERR add_segment: infinite loop",y,t,n);if(!y.b&&!y.d)return void console.log("ERR add_segment: missing successors",y,t,n);o=y.u,o.h=t,o.A=null,d&&d.s==y.s?(s=y,c=d,c.l=y.l,o.left=new H(s),o.right=d.u):(g&&g.t==y.t?(c=y,s=g,s.l=y.l,o.left=g.u):(s=y,c=P(n,y),o.left=new H(s)),o.right=new H(c)),y.e&&y.f?y.C?(y.ba?(c.e=y.f,c.f=y.C,c.e.b=c,c.f.d=c):(s.f=y.e,s.e=y.C,s.e.b=s,s.f.d=s),s.C=c.C=null):y.q==h.q?(c.f.d=c,s.f=c.e=null):c==y?(c.e=c.f,c.f=null,c.e.b=c):(s.f=s.e,s.e=null):r(),y.b&&y.d?o=i():(o=y.b?y.b:y.d,e(o)),s.s&&(s.s.J=c),c.t&&(c.t.K=s),s.s=c.t=t,t.J=s,t.K=c,y.l!=p.l?(g=s,d=c,y=o):y=null}t.v=!0}else console.log("ERR add_segment: missing trFirst.uX: ",h)}function Q(n,t){if(t)var e=n.a,i=n.i,l=n.H;else e=n.i,i=n.a,l=n.I;for(var o;l;)if(l.V)l=-1==r.c.G(e==l.V?i:e,l.V)?l.left:l.right;else{if(!l.h){l.A||console.log("ptNode: unknown type",l),t?n.H=l:n.I=l;break}if(e==l.h.a||e==l.h.i){if(Math.abs(e.y-i.y)<r.c.n){l=Math.abs(l.h.a.y-l.h.i.y)<r.c.n?e==l.h.a?((o=n.p?i.x>=l.h.i.x:i.x<l.h.i.x)?n.o.p:l.h.m.p)?l.right:l.left:((o=n.p?i.x<l.h.a.x:i.x>=l.h.a.x)?n.m.p:l.h.o.p)?l.left:l.right:i.x<e.x?l.left:l.right;continue}o=M(l.h,i),0==o&&(o=e==l.h.a?(o=n.p?i.y>=l.h.i.y:i.y<l.h.i.y)?M(l.h,n.o.a):-M(l.h,l.h.m.i):(o=n.p?i.y<l.h.a.y:i.y>=l.h.a.y)?M(l.h,n.m.i):-M(l.h,l.h.o.a))}else o=M(l.h,e),0==o&&(o=M(l.h,i),0==o&&(o=M(l.h,t?n.o.a:n.m.i)));if(o>0)l=l.left;else{if(!(0>o))break;l=l.right}}}function N(n){Q(n,!0),Q(n,!1)}function M(n,t){var e;e=n.a.x-t.x;var i=n.i.x-t.x,l=Math.abs(n.a.y-t.y)<r.c.n;if(Math.abs(n.i.y-t.y)<r.c.n){if(l)return 0;e=i}else if(!l)return n.p?r.c.N(n.a,n.i,t):r.c.N(n.i,n.a,t);return Math.abs(e)<r.c.n?0:e}function O(n,t,r,e){var i=t.A;if(i.q==r||i.l==r)return t;var l=G(i);return i.l=l.q=r,i.b=l,l.e=i,i.d=l.f=null,l.b&&(l.b.e=l),l.d&&(l.d.f=l),J(n,l),t.V=r,t.A=null,t.right=new H(i),t.left=new H(l),e?i.u:l.u}function P(n,t){var r=G(t);return J(n,r),r}function J(n,t){t.fa=n.B.length,n.B.push(t)}function V(n){this.k=n,this.$=new I(this.k)}function W(n){this.k=n,this.S=null}function X(n){this.k=n}function Z(){this.M=null}var r={ca:"2.0"};r.c={random:Math.random,da:function(n){for(var t=n.length-1;t>0;t--){var e=Math.floor(r.c.random()*(t+1)),i=n[t];n[t]=n[e],n[e]=i}return n},G:function(n,t){var e=n.y-t.y;return e<r.c.D?-1:e>r.c.n?1:(e=n.x-t.x,e<r.c.D?-1:e>r.c.n?1:0)},N:function(n,t,r){return(t.x-n.x)*(r.y-n.y)-(t.y-n.y)*(r.x-n.x)}},r.c.n=Math.pow(2,-43),r.c.D=-r.c.n,u.prototype={Q:function(){return this.F.concat()}},E.prototype={},F.prototype={},H.prototype={},I.prototype={P:function(n){var t,r,e=n.U.length,i=Array(e);for(t=0;e>t;t++)i[t]=Array(8);var l=Array(e);for(t=0,r=this.B.length;r>t;t++){var o=this.B[t],a=o.e?o.f?5:7:o.f?4:6,f=o.b?o.d?1:0:o.d?3:2;if(1==o.depth%2){if(5==a||1==f||7==a&&3==f||4==a&&0==f){var h;h={a:o.l,i:o.q,j:null,g:null,w:!1},n.X.push(h);var u;u={a:o.q,i:o.l,aa:h,j:null,g:null,w:!1},n.X.push(u),h.aa=u,i[o.l.id][f]=h,i[o.q.id][a]=u}}else null!=o.q.id&&(l[o.q.id]=a),null!=o.l.id&&(l[o.l.id]=f)}var s;for(t=0;e>t;t++)if(o=i[t],a=l[t],null!=a){r=a,f=null;do 7<r++&&(r=0),(n=o[r])&&(f?(n.j=f,f.g=n):(s=n.a,s.Y=n),f=n.aa);while(r!=a);f&&(s.Z=f)}}},V.prototype={P:function(){return this.$.P(this.k)}},W.prototype={},X.prototype={},Z.prototype={W:function(){this.M=null},Q:function(){return this.M?this.M.Q():null},ea:function(n,t){if(this.W(),!n||0==n.length)return[];var e=new u(n),i=t?!1:1==e.L;if(i){i=new E(e);n:{var l=i.k,o=l.r[0],a=o,f=o,h=0;do h+=(f.a.x-f.i.x)*(f.a.y+f.i.y),f=f.m;while(f!=o);if(0>h){do a.j=a.m,a=a.g=a.o;while(a!=o);l.F[0]=!1}else do a.j=a.o,a=a.g=a.m;while(a!=o);for(o=l=o;l.g!=l.j;){t:{var a=l.j.a.x,f=l.j.a.y,h=l.a.x,s=l.a.y,c=l.g.a.x,g=l.g.a.y,d=c-h,p=g-s,y=a-c,b=f-g,v=h-a,x=s-f;if(r.c.n>v*p-d*x)a=!1;else{for(var m=l.j.j,M=l.g;M!=m;){var M=M.g,w=M.a.x,I=M.a.y,k=w-a,j=I-f;if(0!=k||0!=j){var R=w-h,F=I-s;if((0!=R||0!=F)&&(w-=c,I-=g,(0!=w||0!=I)&&d*F-p*R>=r.c.D&&v*j-x*k>=r.c.D&&y*I-b*w>=r.c.D)){a=!1;break t}}}a=!0}}if(a)B(i.k,l.j.a,l.a,l.g.a),l.j.g=l.g,l.g.j=l.j,o=l=l.g;else if(l=l.g,l==o){i=!1;break n}}i=!0}}if(!i){if(i=new W(e),i.S=new V(i.k),o=i.S,l=o.k.r.concat(),r.c.da(l),a=0,f=o.k.L,1!=f)for(h=Array(f),s=l.concat(),c=0;c<s.length;c++)g=s[c].O,h[g]?l[f++]=s[c]:(l[a++]=s[c],h[g]=!0);for(a=l.length,f=o.$,h=0,s=a;a>h;){for(s=Math.log(s)/Math.LN2,c=s>1?Math.floor(a/s):a;c>h;h++)L(f,l[h]);for(c=h;a>c;c++)N(l[c])}var H,o=o.k,f=[f.B[0]],h=[],c=0;do{for(g=1==c%2;s=f.pop();)-1==s.depth&&(s.depth=c,s.e&&f.push(s.e),s.f&&f.push(s.f),s.b&&f.push(s.b),s.d&&f.push(s.d),(H=s.t)&&-1==H.J.depth&&h.push(H.J),H=s.s)&&(-1==H.K.depth&&h.push(H.K),H.p!=g&&(o.F[H.O]=!1));f=h,h=[],c++}while(0<f.length);for(c=0;a>c;c++)l[c].J=l[c].K=null;for(i.S.P(),H=i.k,a=0,f=H.r.length;f>a;a++)l=H.r[a],H.F[l.O]?(o=l.i,l.j=l.o,l.g=l.m):(o=l.a,l=l.m,l.j=l.m,l.g=l.o),(h=l.a.Z)&&(h.g=l,l.j=h,l.a.Z=null),(h=o.Y)&&(h.j=l,l.g=h,o.Y=null);for(H=i.k,H.R=[],i=0,l=H.r.length;l>i;i++)if(o=H.r[i],!o.w){n:{for(h=f=a=void 0,s=o,f=h=o.a,o.w=!0,o=o.g;a=o.a;){if(o.w){if(a==f)break;console.log("ERR unique_monotone: segment in two chains",f,o),o=null;break n}o.w=!0,1==r.c.G(a,h)&&(h=a,s=o),o=o.g}o=s}o&&H.R.push(o)}for(H=i=new X(e),i=H.k.R,H.k.T=[],l=0;l<i.length;l++)if(f=i[l],o=f.j,a=f.g,a.g==o)B(H.k,f.a,a.a,o.a);else if(o=H,a=f.g,f=f.a,h=[a.a],s=0,a=a.g,c=a.a,c!=f){for(;c!=f||s>1;)if(s>0)if(g=r.c.N(h[s],c,h[s-1]),Math.abs(g)<=r.c.n&&(c==f||r.c.G(h[s],c)==r.c.G(h[s],h[s-1]))&&(g=1),g>0)B(o.k,h[s-1],h[s],c),s--;else if(h[++s]=c,c==f)for(console.log("ERR uni-y-monotone: only concave angles left",h);s>1;)s--,B(o.k,h[s-1],h[s],h[s+1]);else a=a.g,c=a.a;else h[++s]=c,a=a.g,c=a.a;B(o.k,h[s-1],h[s],c)}}return this.M=e,e.T.concat()}},window.PNLTRI=r,r.REVISION=r.ca,r.Math=r.c,r.Triangulator=Z,Z.prototype.clear_lastData=Z.prototype.W,Z.prototype.get_PolyLeftArr=Z.prototype.Q,Z.prototype.triangulate_polygon=Z.prototype.ea;