THREE.SceneExporter=function(){},THREE.SceneExporter.prototype={constructor:THREE.SceneExporter,parse:function(e){function t(e,r){for(var a=0;a<e.children.length;a++){var i=e.children[a];i instanceof THREE.Mesh?(O.push(h(i,r)),L+=1,i.geometry.id in D||(D[i.geometry.id]=!0,F.push(m(i.geometry)),R+=1),i.material.id in P||(P[i.material.id]=!0,C.push(f(i.material)),S+=1,G(i.material.map),G(i.material.envMap),G(i.material.lightMap),G(i.material.specularMap),G(i.material.bumpMap),G(i.material.normalMap))):i instanceof THREE.Light?(O.push(p(i,r)),L+=1):i instanceof THREE.Camera?(O.push(l(i,r)),L+=1):i instanceof THREE.Object3D&&(O.push(c(i,r)),L+=1),i.children.length>0&&O.push(s(r+1)+'		"children" : {'),t(i,r+2),i.children.length>0&&O.push(s(r+1)+"		}"),O.push(s(r)+"		}"+(a<e.children.length-1?",\n":""))}}function r(e){return"["+e.x+","+e.y+"]"}function a(e){return"["+e.x+","+e.y+","+e.z+"]"}function i(e){return"["+e.r.toFixed(3)+","+e.g.toFixed(3)+","+e.b.toFixed(3)+"]"}function n(e){return'"'+e+'"'}function o(e){for(var t=["NearestFilter","NearestMipMapNearestFilter","NearestMipMapLinearFilter","LinearFilter","LinearMipMapNearestFilter","LinearMipMapLinearFilter"],r=0;r<t.length;r++)if(THREE[t[r]]===e)return n(t[r]);return""}function s(e){for(var t="",r=0;e>r;r++)t+="	";return t}function p(e,t){if(e instanceof THREE.AmbientLight)var r=["		"+n(M(e))+" : {",'	"type"  : "AmbientLight",','	"color" : '+e.color.getHex()+(e.children.length?",":"")];else if(e instanceof THREE.DirectionalLight)var r=["		"+n(M(e))+" : {",'	"type"      : "DirectionalLight",','	"color"     : '+e.color.getHex()+",",'	"intensity" : '+e.intensity+",",'	"direction" : '+a(e.position)+",",'	"target"    : '+n(M(e.target))+(e.children.length?",":"")];else if(e instanceof THREE.PointLight)var r=["		"+n(M(e))+" : {",'	"type"           : "PointLight",','	"color"          : '+e.color.getHex()+",",'	"intensity"      : '+e.intensity+",",'	"position"       : '+a(e.position)+",",'	"decay"          : '+e.decay+",",'	"distance"       : '+e.distance+(e.children.length?",":"")];else if(e instanceof THREE.SpotLight)var r=["		"+n(M(e))+" : {",'	"type"           : "SpotLight",','	"color"          : '+e.color.getHex()+",",'	"intensity"      : '+e.intensity+",",'	"position"       : '+a(e.position)+",",'	"distance"       : '+e.distance+",",'	"angle"          : '+e.angle+",",'	"exponent"       : '+e.exponent+",",'	"decay"          : '+e.decay+",",'	"target"         : '+n(M(e.target))+(e.children.length?",":"")];else if(e instanceof THREE.HemisphereLight)var r=["		"+n(M(e))+" : {",'	"type"        : "HemisphereLight",','	"skyColor"    : '+e.color.getHex()+",",'	"groundColor" : '+e.groundColor.getHex()+",",'	"intensity"   : '+e.intensity+",",'	"position"    : '+a(e.position)+(e.children.length?",":"")];else var r=[];return y(r,"\n		",t)}function l(e,t){if(e instanceof THREE.PerspectiveCamera)var r=["		"+n(M(e))+" : {",'	"type"     : "PerspectiveCamera",','	"fov"      : '+e.fov+",",'	"aspect"   : '+e.aspect+",",'	"near"     : '+e.near+",",'	"far"      : '+e.far+",",'	"position" : '+a(e.position)+(e.children.length?",":"")];else if(e instanceof THREE.OrthographicCamera)var r=["		"+n(M(e))+" : {",'	"type"     : "OrthographicCamera",','	"left"     : '+e.left+",",'	"right"    : '+e.right+",",'	"top"      : '+e.top+",",'	"bottom"   : '+e.bottom+",",'	"near"     : '+e.near+",",'	"far"      : '+e.far+",",'	"position" : '+a(e.position)+(e.children.length?",":"")];else var r=[];return y(r,"\n		",t)}function c(e,t){var r=["		"+n(M(e))+" : {",'	"position" : '+a(e.position)+",",'	"rotation" : '+a(e.rotation)+",",'	"scale"	   : '+a(e.scale)+",",'	"visible"  : '+e.visible+(e.children.length?",":"")];return y(r,"\n		",t)}function h(e,t){var r=["		"+n(M(e))+" : {",'	"geometry" : '+n(d(e.geometry))+",",'	"material" : '+n(v(e.material))+",",'	"position" : '+a(e.position)+",",'	"rotation" : '+a(e.rotation)+",",'	"scale"	   : '+a(e.scale)+",",'	"visible"  : '+e.visible+(e.children.length?",":"")];return y(r,"\n		",t)}function m(e){if(e instanceof THREE.SphereGeometry)var t=["	"+n(d(e))+": {",'	"type"    : "sphere",','	"radius"  : '+e.parameters.radius+",",'	"widthSegments"  : '+e.parameters.widthSegments+",",'	"heightSegments" : '+e.parameters.heightSegments,"}"];else if(e instanceof THREE.BoxGeometry)var t=["	"+n(d(e))+": {",'	"type"    : "cube",','	"width"  : '+e.parameters.width+",",'	"height"  : '+e.parameters.height+",",'	"depth"  : '+e.parameters.depth+",",'	"widthSegments"  : '+e.widthSegments+",",'	"heightSegments" : '+e.heightSegments+",",'	"depthSegments" : '+e.depthSegments,"}"];else if(e instanceof THREE.PlaneGeometry)var t=["	"+n(d(e))+": {",'	"type"    : "plane",','	"width"  : '+e.width+",",'	"height"  : '+e.height+",",'	"widthSegments"  : '+e.widthSegments+",",'	"heightSegments" : '+e.heightSegments,"}"];else if(e instanceof THREE.Geometry)if("ascii"===e.sourceType||"ctm"===e.sourceType||"stl"===e.sourceType||"vtk"===e.sourceType)var t=["	"+n(d(e))+": {",'	"type" : '+n(e.sourceType)+",",'	"url"  : '+n(e.sourceFile),"}"];else var t=[];else var t=[];return y(t,"\n		")}function f(e){if(e instanceof THREE.MeshBasicMaterial)var t=["	"+n(v(e))+": {",'	"type"    : "MeshBasicMaterial",','	"parameters"  : {','		"color"  : '+e.color.getHex()+",",e.map?'		"map" : '+n(E(e.map))+",":"",e.envMap?'		"envMap" : '+n(E(e.envMap))+",":"",e.specularMap?'		"specularMap" : '+n(E(e.specularMap))+",":"",e.lightMap?'		"lightMap" : '+n(E(e.lightMap))+",":"",'		"reflectivity"  : '+e.reflectivity+",",'		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshLambertMaterial)var t=["	"+n(v(e))+": {",'	"type"    : "MeshLambertMaterial",','	"parameters"  : {','		"color"  : '+e.color.getHex()+",",'		"emissive"  : '+e.emissive.getHex()+",",e.map?'		"map" : '+n(E(e.map))+",":"",e.envMap?'		"envMap" : '+n(E(e.envMap))+",":"",e.specularMap?'		"specularMap" : '+n(E(e.specularMap))+",":"",e.lightMap?'		"lightMap" : '+n(E(e.lightMap))+",":"",'		"reflectivity"  : '+e.reflectivity+",",'		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshPhongMaterial)var t=["	"+n(v(e))+": {",'	"type"    : "MeshPhongMaterial",','	"parameters"  : {','		"color"  : '+e.color.getHex()+",",'		"emissive"  : '+e.emissive.getHex()+",",'		"specular"  : '+e.specular.getHex()+",",'		"shininess" : '+e.shininess+",",e.map?'		"map" : '+n(E(e.map))+",":"",e.envMap?'		"envMap" : '+n(E(e.envMap))+",":"",e.specularMap?'		"specularMap" : '+n(E(e.specularMap))+",":"",e.lightMap?'		"lightMap" : '+n(E(e.lightMap))+",":"",e.normalMap?'		"normalMap" : '+n(E(e.normalMap))+",":"",e.bumpMap?'		"bumpMap" : '+n(E(e.bumpMap))+",":"",'		"bumpScale"  : '+e.bumpScale+",",'		"reflectivity"  : '+e.reflectivity+",",'		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshDepthMaterial)var t=["	"+n(v(e))+": {",'	"type"    : "MeshDepthMaterial",','	"parameters"  : {','		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshNormalMaterial)var t=["	"+n(v(e))+": {",'	"type"    : "MeshNormalMaterial",','	"parameters"  : {','		"transparent" : '+e.transparent+",",'		"opacity" : '+e.opacity+",",'		"wireframe" : '+e.wireframe+",",'		"wireframeLinewidth" : '+e.wireframeLinewidth,"	}","}"];else if(e instanceof THREE.MeshFaceMaterial)var t=["	"+n(v(e))+": {",'	"type"    : "MeshFaceMaterial",','	"parameters"  : {}',"}"];return y(t,"\n		")}function g(e){var t=["	"+n(E(e))+": {",'	"url"    : "'+e.sourceFile+'",','	"repeat" : '+r(e.repeat)+",",'	"offset" : '+r(e.offset)+",",'	"magFilter" : '+o(e.magFilter)+",",'	"minFilter" : '+o(e.minFilter)+",",'	"anisotropy" : '+e.anisotropy,"}"];return y(t,"\n		")}function u(e){if(e instanceof THREE.Fog)var t=["	"+n(H(e))+": {",'	"type"  : "linear",','	"color" : '+i(e.color)+",",'	"near"  : '+e.near+",",'	"far"   : '+e.far,"}"];else if(e instanceof THREE.FogExp2)var t=["	"+n(H(e))+": {",'	"type"    : "exp2",','	"color"   : '+i(e.color)+",",'	"density" : '+e.density,"}"];else var t=[];return y(t,"\n		")}function y(e,t,r){for(var a=[],i=0;i<e.length;i++){var n=e[i];n&&(r&&(n=s(r)+n),a.push(n))}return a.join(t)}function M(e){return e.name?e.name:"Object_"+e.id}function d(e){return e.name?e.name:"Geometry_"+e.id}function v(e){return e.name?e.name:"Material_"+e.id}function E(e){return e.name?e.name:"Texture_"+e.id}function H(e){return e.name?e.name:"Default fog"}var w=a(e.position),T=a(e.rotation),x=a(e.scale),L=0,R=0,S=0,b=0,F=[],C=[],N=[],j=[],D={},P={},B={},G=function(e){e&&(e.id in B||(B[e.id]=!0,N.push(g(e)),b+=1))},O=[];t(e,0);var _=O.join("\n");e.fog&&j.push(u(e.fog));var k=y(F,",\n\n	"),A=y(C,",\n\n	"),z=y(N,",\n\n	"),J=y(j,",\n\n	"),V=null;e.traverse(function(e){e instanceof THREE.Camera&&e.userData.active&&(V=e)});var q=n(V?M(V):""),I=n(e.fog?H(e.fog):""),K=["{",'	"metadata": {','		"formatVersion" : 3.2,','		"type"		: "scene",','		"generatedBy"	: "SceneExporter",','		"objects"       : '+L+",",'		"geometries"    : '+R+",",'		"materials"     : '+S+",",'		"textures"      : '+b,"	},","",'	"urlBaseType": "relativeToScene",',"",'	"objects" :',"	{",_,"	},","",'	"geometries" :',"	{","	"+k,"	},","",'	"materials" :',"	{","	"+A,"	},","",'	"textures" :',"	{","	"+z,"	},","",'	"fogs" :',"	{","	"+J,"	},","",'	"transform" :',"	{",'		"position"  : '+w+",",'		"rotation"  : '+T+",",'		"scale"     : '+x,"	},","",'	"defaults" :',"	{",'		"camera"  : '+q+",",'		"fog"  	  : '+I,"	}","}"].join("\n");return JSON.parse(K)}};