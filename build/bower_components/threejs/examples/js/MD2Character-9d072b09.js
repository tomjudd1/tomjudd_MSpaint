THREE.MD2Character=function(){function e(e,s){for(var a=THREE.UVMapping,t=[],n=0;n<s.length;n++)t[n]=THREE.ImageUtils.loadTexture(e+s[n],a,i),t[n].name=s[n];return t}function s(e,s){e.computeMorphNormals();var i=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(16777215)),t=new THREE.MeshPhongMaterial({color:16755200,specular:1118481,shininess:50,wireframe:!0,shading:THREE.SmoothShading,map:i,morphTargets:!0,morphNormals:!0,metal:!1}),n=new THREE.MeshPhongMaterial({color:16777215,specular:1118481,shininess:50,wireframe:!1,shading:THREE.SmoothShading,map:s,morphTargets:!0,morphNormals:!0,metal:!1});n.wrapAround=!0;var o=new THREE.MorphAnimMesh(e,n);return o.rotation.y=-Math.PI/2,o.castShadow=!0,o.receiveShadow=!0,o.materialTexture=n,o.materialWireframe=t,o.parseAnimations(),o.playAnimation(e.firstAnimation,a.animationFPS),o.baseDuration=o.duration,o}function i(){a.loadCounter-=1,0===a.loadCounter&&a.onLoadComplete()}var a=this;this.scale=1,this.animationFPS=6,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(t){this.loadCounter=2*t.weapons.length+t.skins.length+1;for(var n=[],o=0;o<t.weapons.length;o++)n[o]=t.weapons[o][1];this.skinsBody=e(t.baseUrl+"skins/",t.skins),this.skinsWeapon=e(t.baseUrl+"skins/",n);var h=new THREE.JSONLoader;h.load(t.baseUrl+t.body,function(e){e.computeBoundingBox(),a.root.position.y=-a.scale*e.boundingBox.min.y;var t=s(e,a.skinsBody[0]);t.scale.set(a.scale,a.scale,a.scale),a.root.add(t),a.meshBody=t,a.activeAnimation=e.firstAnimation,i()});for(var m=function(e,t){return function(n){var o=s(n,a.skinsWeapon[e]);o.scale.set(a.scale,a.scale,a.scale),o.visible=!1,o.name=t,a.root.add(o),a.weapons[e]=o,a.meshWeapon=o,i()}},o=0;o<t.weapons.length;o++)h.load(t.baseUrl+t.weapons[o][0],m(o,t.weapons[o][0]))},this.setPlaybackRate=function(e){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/e),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/e)},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(e){for(var s=0;s<this.weapons.length;s++)this.weapons[s].visible=!1;var i=this.weapons[e];i&&(i.visible=!0,this.meshWeapon=i,i.playAnimation(this.activeAnimation,this.animationFPS),this.meshWeapon.baseDuration=this.meshWeapon.duration,this.meshWeapon.time=this.meshBody.time,this.meshWeapon.duration=this.meshBody.duration)},this.setAnimation=function(e){this.meshBody&&(this.meshBody.playAnimation(e,this.animationFPS),this.meshBody.baseDuration=this.meshBody.duration),this.meshWeapon&&(this.meshWeapon.playAnimation(e,this.animationFPS),this.meshWeapon.baseDuration=this.meshWeapon.duration,this.meshWeapon.time=this.meshBody.time),this.activeAnimation=e},this.update=function(e){this.meshBody&&this.meshBody.updateAnimation(1e3*e),this.meshWeapon&&this.meshWeapon.updateAnimation(1e3*e)}};