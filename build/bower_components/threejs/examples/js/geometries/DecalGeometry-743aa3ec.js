THREE.DecalVertex=function(e,t){this.vertex=e,this.normal=t},THREE.DecalVertex.prototype.clone=function(){return new THREE.DecalVertex(this.vertex.clone(),this.normal.clone())},THREE.DecalGeometry=function(e,t,r,s,a){THREE.Geometry.call(this),void 0===a&&(a=null),a=a||new THREE.Vector3(1,1,1),this.uvs=[],this.cube=new THREE.Mesh(new THREE.BoxGeometry(s.x,s.y,s.z),new THREE.MeshBasicMaterial),this.cube.rotation.set(r.x,r.y,r.z),this.cube.position.copy(t),this.cube.scale.set(1,1,1),this.cube.updateMatrix(),this.iCubeMatrix=(new THREE.Matrix4).getInverse(this.cube.matrix),this.faceIndices=["a","b","c","d"],this.clipFace=function(e,t){function r(e,t,r){var s=e.vertex.dot(r)-a,c=t.vertex.dot(r)-a,o=s/(s-c),h=new THREE.DecalVertex(new THREE.Vector3(e.vertex.x+o*(t.vertex.x-e.vertex.x),e.vertex.y+o*(t.vertex.y-e.vertex.y),e.vertex.z+o*(t.vertex.z-e.vertex.z)),new THREE.Vector3(e.normal.x+o*(t.normal.x-e.normal.x),e.normal.y+o*(t.normal.y-e.normal.y),e.normal.z+o*(t.normal.z-e.normal.z)));return h}var a=.5*Math.abs(s.clone().dot(t));if(0===e.length)return[];for(var c=[],o=0;o<e.length;o+=3){var h,n,i,l=0,p=e[o+0].vertex.dot(t)-a,u=e[o+1].vertex.dot(t)-a,x=e[o+2].vertex.dot(t)-a;switch(h=p>0,n=u>0,i=x>0,l=(h?1:0)+(n?1:0)+(i?1:0)){case 0:c.push(e[o]),c.push(e[o+1]),c.push(e[o+2]);break;case 1:var v,E,m;if(h&&(v=e[o+1],E=e[o+2],m=r(e[o],v,t),nV4=r(e[o],E,t)),n){v=e[o],E=e[o+2],m=r(e[o+1],v,t),nV4=r(e[o+1],E,t),c.push(m),c.push(E.clone()),c.push(v.clone()),c.push(E.clone()),c.push(m.clone()),c.push(nV4);break}i&&(v=e[o],E=e[o+1],m=r(e[o+2],v,t),nV4=r(e[o+2],E,t)),c.push(v.clone()),c.push(E.clone()),c.push(m),c.push(nV4),c.push(m.clone()),c.push(E.clone());break;case 2:var v,E,m;h||(v=e[o].clone(),E=r(v,e[o+1],t),m=r(v,e[o+2],t),c.push(v),c.push(E),c.push(m)),n||(v=e[o+1].clone(),E=r(v,e[o+2],t),m=r(v,e[o],t),c.push(v),c.push(E),c.push(m)),i||(v=e[o+2].clone(),E=r(v,e[o],t),m=r(v,e[o+1],t),c.push(v),c.push(E),c.push(m));break;case 3:}}return c},this.pushVertex=function(t,r,s){var a=e.geometry.vertices[r].clone();a.applyMatrix4(e.matrix),a.applyMatrix4(this.iCubeMatrix),t.push(new THREE.DecalVertex(a,s.clone()))},this.computeDecal=function(){for(var t=[],r=0;r<e.geometry.faces.length;r++){var c=e.geometry.faces[r],o=[];this.pushVertex(o,c[this.faceIndices[0]],c.vertexNormals[0]),this.pushVertex(o,c[this.faceIndices[1]],c.vertexNormals[1]),this.pushVertex(o,c[this.faceIndices[2]],c.vertexNormals[2]),a.x&&(o=this.clipFace(o,new THREE.Vector3(1,0,0)),o=this.clipFace(o,new THREE.Vector3(-1,0,0))),a.y&&(o=this.clipFace(o,new THREE.Vector3(0,1,0)),o=this.clipFace(o,new THREE.Vector3(0,-1,0))),a.z&&(o=this.clipFace(o,new THREE.Vector3(0,0,1)),o=this.clipFace(o,new THREE.Vector3(0,0,-1)));for(var h=0;h<o.length;h++){var n=o[h];this.uvs.push(new THREE.Vector2(.5+n.vertex.x/s.x,.5+n.vertex.y/s.y)),o[h].vertex.applyMatrix4(this.cube.matrix)}0!==o.length&&(t=t.concat(o))}for(var i=0;i<t.length;i+=3){this.vertices.push(t[i].vertex,t[i+1].vertex,t[i+2].vertex);var c=new THREE.Face3(i,i+1,i+2);c.vertexNormals.push(t[i+0].normal),c.vertexNormals.push(t[i+1].normal),c.vertexNormals.push(t[i+2].normal),this.faces.push(c),this.faceVertexUvs[0].push([this.uvs[i],this.uvs[i+1],this.uvs[i+2]])}this.verticesNeedUpdate=!0,this.elementsNeedUpdate=!0,this.morphTargetsNeedUpdate=!0,this.uvsNeedUpdate=!0,this.normalsNeedUpdate=!0,this.colorsNeedUpdate=!0,this.tangentsNeedUpdate=!0,this.computeFaceNormals()},this.computeDecal()},THREE.DecalGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.DecalGeometry.prototype.constructor=THREE.DecalGeometry;