THREE.DepthPassPlugin=function(){function e(r,t,a){if(t.visible){var i=n[t.id];if(i&&(t.frustumCulled===!1||m.intersectsObject(t)===!0))for(var s=0,l=i.length;l>s;s++){var o=i[s];t._modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,t.matrixWorld),u.push(o)}for(var s=0,l=t.children.length;l>s;s++)e(r,t.children[s],a)}}function r(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,a,i,n,s,l,o,d,h,m=new THREE.Frustum,f=new THREE.Matrix4,u=[];this.init=function(e,r,m,f){t=e.context,a=e,i=r,n=m,s=f;var u=THREE.ShaderLib.depthRGBA,c=THREE.UniformsUtils.clone(u.uniforms);l=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c}),o=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c,morphTargets:!0}),d=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c,skinning:!0}),h=new THREE.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:c,morphTargets:!0,skinning:!0}),l._shadowPass=!0,o._shadowPass=!0,d._shadowPass=!0,h._shadowPass=!0},this.render=function(e,r){this.enabled&&this.update(e,r)},this.update=function(n,c){var g,E,v,x,S,T,p=null;t.clearColor(1,1,1,1),t.disable(t.BLEND),a.state.setDepthTest(!0),n.autoUpdate===!0&&n.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),f.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),m.setFromMatrix(f),a.setRenderTarget(this.renderTarget),a.clear(),u.length=0,e(n,n,c);var M,R,b;for(g=0,E=u.length;E>g;g++)S=u[g],T=S.object,v=S.buffer,T instanceof THREE.PointCloud&&!T.customDepthMaterial||(M=r(T),M&&a.setMaterialFaces(T.material),R=void 0!==T.geometry.morphTargets&&T.geometry.morphTargets.length>0&&M.morphTargets,b=T instanceof THREE.SkinnedMesh&&M.skinning,x=T.customDepthMaterial?T.customDepthMaterial:b?R?h:d:R?o:l,v instanceof THREE.BufferGeometry?a.renderBufferDirect(c,i,p,x,v,T):a.renderBuffer(c,i,p,x,v,T));for(g=0,E=s.length;E>g;g++)S=s[g],T=S.object,T.visible&&(T._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,T.matrixWorld),a.renderImmediateObject(c,i,p,l,T));var H=a.getClearColor(),w=a.getClearAlpha();t.clearColor(H.r,H.g,H.b,w),t.enable(t.BLEND)}};