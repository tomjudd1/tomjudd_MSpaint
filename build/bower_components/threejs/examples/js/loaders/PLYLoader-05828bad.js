THREE.PLYLoader=function(){this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,setPropertyNameMapping:function(e){this.propertyNameMapping=e},load:function(e,t){var r=this,n=new XMLHttpRequest;n.addEventListener("load",function(e){var n=r.parse(e.target.response);r.dispatchEvent({type:"load",content:n}),t&&t(n)},!1),n.addEventListener("progress",function(e){r.dispatchEvent({type:"progress",loaded:e.loaded,total:e.total})},!1),n.addEventListener("error",function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null)},bin2str:function(e){for(var t=new Uint8Array(e),r="",n=0;n<e.byteLength;n++)r+=String.fromCharCode(t[n]);return r},isASCII:function(e){var t=this.parseHeader(this.bin2str(e));return"ascii"===t.format},parse:function(e){return e instanceof ArrayBuffer?this.isASCII(e)?this.parseASCII(this.bin2str(e)):this.parseBinary(e):this.parseASCII(e)},parseHeader:function(e){function t(e,t){var r={type:e[0]};return"list"===r.type?(r.name=e[3],r.countType=e[1],r.itemType=e[2]):r.name=e[1],r.name in t&&(r.name=t[r.name]),r}var r=/ply([\s\S]*)end_header\s/,n="",a=0,s=r.exec(e);null!==s&&(n=s[1],a=s[0].length);for(var i,o,c={comments:[],elements:[],headerLength:a},p=n.split("\n"),u=void 0,l=0;l<p.length;l++){var h=p[l];if(h=h.trim(),""!==h)switch(o=h.split(/\s+/),i=o.shift(),h=o.join(" "),i){case"format":c.format=o[0],c.version=o[1];break;case"comment":c.comments.push(h);break;case"element":void 0!==u&&c.elements.push(u),u=Object(),u.name=o[0],u.count=parseInt(o[1]),u.properties=[];break;case"property":u.properties.push(t(o,this.propertyNameMapping));break;default:console.log("unhandled",i,o)}}return void 0!==u&&c.elements.push(u),c},parseASCIINumber:function(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}},parseASCIIElement:function(e,t){for(var r=t.split(/\s+/),n=Object(),a=0;a<e.length;a++)if("list"===e[a].type){for(var s=[],i=this.parseASCIINumber(r.shift(),e[a].countType),o=0;i>o;o++)s.push(this.parseASCIINumber(r.shift(),e[a].itemType));n[e[a].name]=s}else n[e[a].name]=this.parseASCIINumber(r.shift(),e[a].type);return n},parseASCII:function(e){var t,r=new THREE.Geometry,n=this.parseHeader(e),a=/end_header\s([\s\S]*)$/,s="";null!==(t=a.exec(e))&&(s=t[1]);var i=s.split("\n"),o=0,c=0;r.useColor=!1;for(var p=0;p<i.length;p++){var u=i[p];if(u=u.trim(),""!==u){c>=n.elements[o].count&&(o++,c=0);var l=this.parseASCIIElement(n.elements[o].properties,u);this.handleElement(r,n.elements[o].name,l),c++}}return this.postProcess(r)},postProcess:function(e){if(e.useColor){for(var t=0;t<e.faces.length;t++)e.faces[t].vertexColors=[e.colors[e.faces[t].a],e.colors[e.faces[t].b],e.colors[e.faces[t].c]];e.elementsNeedUpdate=!0}return e.computeBoundingSphere(),e},handleElement:function(e,t,r){if("vertex"===t){if(e.vertices.push(new THREE.Vector3(r.x,r.y,r.z)),"red"in r&&"green"in r&&"blue"in r){e.useColor=!0;var n=new THREE.Color;n.setRGB(r.red/255,r.green/255,r.blue/255),e.colors.push(n)}}else if("face"===t){var a=r.vertex_indices;3===a.length?e.faces.push(new THREE.Face3(a[0],a[1],a[2])):4===a.length&&e.faces.push(new THREE.Face3(a[0],a[1],a[3]),new THREE.Face3(a[1],a[2],a[3]))}},binaryRead:function(e,t,r,n){switch(r){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,n),2];case"uint16":case"ushort":return[e.getUint16(t,n),2];case"int32":case"int":return[e.getInt32(t,n),4];case"uint32":case"uint":return[e.getUint32(t,n),4];case"float32":case"float":return[e.getFloat32(t,n),4];case"float64":case"double":return[e.getFloat64(t,n),8]}},binaryReadElement:function(e,t,r,n){for(var a,s=Object(),i=0,o=0;o<r.length;o++)if("list"===r[o].type){var c=[];a=this.binaryRead(e,t+i,r[o].countType,n);var p=a[0];i+=a[1];for(var u=0;p>u;u++)a=this.binaryRead(e,t+i,r[o].itemType,n),c.push(a[0]),i+=a[1];s[r[o].name]=c}else a=this.binaryRead(e,t+i,r[o].type,n),s[r[o].name]=a[0],i+=a[1];return[s,i]},parseBinary:function(e){for(var t,r=new THREE.Geometry,n=this.parseHeader(this.bin2str(e)),a="binary_little_endian"===n.format,s=new DataView(e,n.headerLength),i=0,o=0;o<n.elements.length;o++)for(var c=0;c<n.elements[o].count;c++){t=this.binaryReadElement(s,i,n.elements[o].properties,a),i+=t[1];var p=t[0];this.handleElement(r,n.elements[o].name,p)}return this.postProcess(r)}},THREE.EventDispatcher.prototype.apply(THREE.PLYLoader.prototype);