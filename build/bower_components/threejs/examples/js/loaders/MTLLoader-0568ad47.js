THREE.MTLLoader=function(r,t,e){this.baseUrl=r,this.options=t,this.crossOrigin=e},THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function(r,t,e,a){var i=this,s=new THREE.XHRLoader;s.setCrossOrigin(this.crossOrigin),s.load(r,function(r){t(i.parse(r))},e,a)},parse:function(r){for(var t=r.split("\n"),e={},a=/\s+/,i={},s=0;s<t.length;s++){var o=t[s];if(o=o.trim(),0!==o.length&&"#"!==o.charAt(0)){var n=o.indexOf(" "),h=n>=0?o.substring(0,n):o;h=h.toLowerCase();var p=n>=0?o.substring(n+1):"";if(p=p.trim(),"newmtl"===h)e={name:p},i[p]=e;else if(e)if("ka"===h||"kd"===h||"ks"===h){var l=p.split(a,3);e[h]=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])]}else e[h]=p}}var c=new THREE.MTLLoader.MaterialCreator(this.baseUrl,this.options);return c.crossOrigin=this.crossOrigin,c.setMaterials(i),c}},THREE.MTLLoader.MaterialCreator=function(r,t){this.baseUrl=r,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping},THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,setMaterials:function(r){this.materialsInfo=this.convert(r),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(r){if(!this.options)return r;var t={};for(var e in r){var a=r[e],i={};t[e]=i;for(var s in a){var o=!0,n=a[s],h=s.toLowerCase();switch(h){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(n=[n[0]/255,n[1]/255,n[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===n[0]&&0===n[1]&&0===n[1]&&(o=!1);break;case"d":this.options&&this.options.invertTransparency&&(n=1-n)}o&&(i[h]=n)}}return t},preload:function(){for(var r in this.materialsInfo)this.create(r)},getIndex:function(r){return this.nameLookup[r]},getAsArray:function(){var r=0;for(var t in this.materialsInfo)this.materialsArray[r]=this.create(t),this.nameLookup[t]=r,r++;return this.materialsArray},create:function(r){return void 0===this.materials[r]&&this.createMaterial_(r),this.materials[r]},createMaterial_:function(r){var t=this.materialsInfo[r],e={name:r,side:this.side};for(var a in t){var i=t[a];switch(a.toLowerCase()){case"kd":e.diffuse=(new THREE.Color).fromArray(i);break;case"ka":break;case"ks":e.specular=(new THREE.Color).fromArray(i);break;case"map_kd":e.map=this.loadTexture(this.baseUrl+i),e.map.wrapS=this.wrap,e.map.wrapT=this.wrap;break;case"ns":e.shininess=i;break;case"d":1>i&&(e.transparent=!0,e.opacity=i);break;case"map_bump":case"bump":if(e.bumpMap)break;e.bumpMap=this.loadTexture(this.baseUrl+i),e.bumpMap.wrapS=this.wrap,e.bumpMap.wrapT=this.wrap}}return e.diffuse&&(e.color=e.diffuse),this.materials[r]=new THREE.MeshPhongMaterial(e),this.materials[r]},loadTexture:function(r,t,e){var a,i=THREE.Loader.Handlers.get(r);return null!==i?a=i.load(r,e):(a=new THREE.Texture,i=new THREE.ImageLoader,i.crossOrigin=this.crossOrigin,i.load(r,function(r){a.image=THREE.MTLLoader.ensurePowerOfTwo_(r),a.needsUpdate=!0,e&&e(a)})),void 0!==t&&(a.mapping=t),a}},THREE.MTLLoader.ensurePowerOfTwo_=function(r){if(!THREE.Math.isPowerOfTwo(r.width)||!THREE.Math.isPowerOfTwo(r.height)){var t=document.createElement("canvas");t.width=THREE.MTLLoader.nextHighestPowerOfTwo_(r.width),t.height=THREE.MTLLoader.nextHighestPowerOfTwo_(r.height);var e=t.getContext("2d");return e.drawImage(r,0,0,r.width,r.height,0,0,t.width,t.height),t}return r},THREE.MTLLoader.nextHighestPowerOfTwo_=function(r){--r;for(var t=1;32>t;t<<=1)r|=r>>t;return r+1},THREE.EventDispatcher.prototype.apply(THREE.MTLLoader.prototype);