THREE.SceneLoader=function(e){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader),this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,r,a,t){var i=this,o=new THREE.XHRLoader(i.manager);o.setCrossOrigin(this.crossOrigin),o.load(e,function(a){i.parse(JSON.parse(a),r,e)},a,t)},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,r){this.geometryHandlers[e]={loaderClass:r}},addHierarchyHandler:function(e,r){this.hierarchyHandlers[e]={loaderClass:r}},parse:function(e,r,a){function t(e,r){return"relativeToHTML"==r?e:A+e}function i(){o(L.scene,j.objects)}function o(e,r){var a,i,n,s,l;for(var p in r){var d=L.objects[p],c=r[p];if(void 0===d){if(c.type&&c.type in S.hierarchyHandlers){if(void 0===c.loading){E=L.materials[c.material],c.loading=!0;var g=S.hierarchyHandlers[c.type].loaderObject;g.options?g.load(t(c.url,j.urlBaseType),m(p,e,E,c)):g.load(t(c.url,j.urlBaseType),m(p,e,E,c))}}else if(void 0!==c.geometry){if(f=L.geometries[c.geometry]){var u=!1;if(E=L.materials[c.material],u=E instanceof THREE.ShaderMaterial,i=c.position,n=c.rotation,s=c.scale,a=c.matrix,l=c.quaternion,c.material||(E=new THREE.MeshFaceMaterial(L.face_materials[c.geometry])),E instanceof THREE.MeshFaceMaterial&&0===E.materials.length&&(E=new THREE.MeshFaceMaterial(L.face_materials[c.geometry])),E instanceof THREE.MeshFaceMaterial)for(var y=0;y<E.materials.length;y++)u=u||E.materials[y]instanceof THREE.ShaderMaterial;u&&f.computeTangents(),c.skin?d=new THREE.SkinnedMesh(f,E):c.morph?(d=new THREE.MorphAnimMesh(f,E),void 0!==c.duration&&(d.duration=c.duration),void 0!==c.time&&(d.time=c.time),void 0!==c.mirroredLoop&&(d.mirroredLoop=c.mirroredLoop),E.morphNormals&&f.computeMorphNormals()):d=new THREE.Mesh(f,E),d.name=p,a?(d.matrixAutoUpdate=!1,d.matrix.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])):(d.position.fromArray(i),l?d.quaternion.fromArray(l):d.rotation.fromArray(n),d.scale.fromArray(s)),d.visible=c.visible,d.castShadow=c.castShadow,d.receiveShadow=c.receiveShadow,e.add(d),L.objects[p]=d}}else if("AmbientLight"===c.type||"PointLight"===c.type||"DirectionalLight"===c.type||"SpotLight"===c.type||"HemisphereLight"===c.type||"AreaLight"===c.type){var H=c.color,T=c.intensity,R=c.distance,b=c.position,w=c.rotation;switch(c.type){case"AmbientLight":v=new THREE.AmbientLight(H);break;case"PointLight":v=new THREE.PointLight(H,T,R),v.position.fromArray(b);break;case"DirectionalLight":v=new THREE.DirectionalLight(H,T),v.position.fromArray(c.direction);break;case"SpotLight":v=new THREE.SpotLight(H,T,R,1),v.angle=c.angle,v.position.fromArray(b),v.target.set(b[0],b[1]-R,b[2]),v.target.applyEuler(new THREE.Euler(w[0],w[1],w[2],"XYZ"));break;case"HemisphereLight":v=new THREE.DirectionalLight(H,T,R),v.target.set(b[0],b[1]-R,b[2]),v.target.applyEuler(new THREE.Euler(w[0],w[1],w[2],"XYZ"));break;case"AreaLight":v=new THREE.AreaLight(H,T),v.position.fromArray(b),v.width=c.size,v.height=c.size_y}e.add(v),v.name=p,L.lights[p]=v,L.objects[p]=v}else"PerspectiveCamera"===c.type||"OrthographicCamera"===c.type?(i=c.position,n=c.rotation,l=c.quaternion,"PerspectiveCamera"===c.type?h=new THREE.PerspectiveCamera(c.fov,c.aspect,c.near,c.far):"OrthographicCamera"===c.type&&(h=new THREE.OrthographicCamera(c.left,c.right,c.top,c.bottom,c.near,c.far)),h.name=p,h.position.fromArray(i),void 0!==l?h.quaternion.fromArray(l):void 0!==n?h.rotation.fromArray(n):c.target&&h.lookAt((new THREE.Vector3).fromArray(c.target)),e.add(h),L.cameras[p]=h,L.objects[p]=h):(i=c.position,n=c.rotation,s=c.scale,l=c.quaternion,d=new THREE.Object3D,d.name=p,d.position.fromArray(i),l?d.quaternion.fromArray(l):d.rotation.fromArray(n),d.scale.fromArray(s),d.visible=void 0!==c.visible?c.visible:!1,e.add(d),L.objects[p]=d,L.empties[p]=d);if(d){if(void 0!==c.userData)for(var A in c.userData){var M=c.userData[A];d.userData[A]=M}if(void 0!==c.groups)for(var y=0;y<c.groups.length;y++){var x=c.groups[y];void 0===L.groups[x]&&(L.groups[x]=[]),L.groups[x].push(p)}}}void 0!==d&&void 0!==c.children&&o(d,c.children)}}function n(e,r,a){L.geometries[a]=e,L.face_materials[a]=r,i()}function s(e,r,a,t,o){var n=o.position,s=o.rotation,l=o.quaternion,m=o.scale;e.position.fromArray(n),l?e.quaternion.fromArray(l):e.rotation.fromArray(s),e.scale.fromArray(m),t&&e.traverse(function(e){e.material=t});var p=void 0!==o.visible?o.visible:!0;e.traverse(function(e){e.visible=p}),a.add(e),e.name=r,L.objects[r]=e,i()}function l(e){return function(r,a){r.name=e,n(r,a,e),T-=1,S.onLoadComplete(),d()}}function m(e,r,a,t){return function(i){var o;o=i.content?i.content:i.dae?i.scene:i,s(o,e,r,a,t),T-=1,S.onLoadComplete(),d()}}function p(e){return function(r,a){r.name=e,L.geometries[e]=r,L.face_materials[e]=a}}function d(){var e={totalModels:b,totalTextures:w,loadedModels:b-T,loadedTextures:w-R};S.callbackProgress(e,L),S.onLoadProgress(),0===T&&0===R&&(c(),r(L))}function c(){for(var e=0;e<M.length;e++){var r=M[e],a=L.objects[r.targetName];a?r.object.target=a:(r.object.target=new THREE.Object3D,L.scene.add(r.object.target)),r.object.target.userData.targetInverse=r.object}}function g(e,r){if(r(e),void 0!==e.children)for(var a in e.children)g(e.children[a],r)}var f,E,h,u,y,H,v,T,R,b,w,L,S=this,A=THREE.Loader.prototype.extractUrlBase(a),M=[],j=e;for(var x in this.geometryHandlers){var C=this.geometryHandlers[x].loaderClass;this.geometryHandlers[x].loaderObject=new C}for(var x in this.hierarchyHandlers){var C=this.hierarchyHandlers[x].loaderClass;this.hierarchyHandlers[x].loaderObject=new C}if(T=0,R=0,L={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},j.transform){var O=j.transform.position,F=j.transform.rotation,k=j.transform.scale;O&&L.scene.position.fromArray(O),F&&L.scene.rotation.fromArray(F),k&&L.scene.scale.fromArray(k),(O||F||k)&&(L.scene.updateMatrix(),L.scene.updateMatrixWorld())}var D,B,P=function(e){R-=e,d(),S.onLoadComplete()},G=function(e){return function(){P(e)}};for(D in j.fogs)B=j.fogs[D],"linear"===B.type?u=new THREE.Fog(0,B.near,B.far):"exp2"===B.type&&(u=new THREE.FogExp2(0,B.density)),H=B.color,u.color.setRGB(H[0],H[1],H[2]),L.fogs[D]=u;var q,N;for(q in j.geometries)N=j.geometries[q],N.type in this.geometryHandlers&&(T+=1,S.onLoadStart());for(var _ in j.objects)g(j.objects[_],function(e){e.type&&e.type in S.hierarchyHandlers&&(T+=1,S.onLoadStart())});b=T;for(q in j.geometries)if(N=j.geometries[q],"cube"===N.type)f=new THREE.BoxGeometry(N.width,N.height,N.depth,N.widthSegments,N.heightSegments,N.depthSegments),f.name=q,L.geometries[q]=f;else if("plane"===N.type)f=new THREE.PlaneGeometry(N.width,N.height,N.widthSegments,N.heightSegments),f.name=q,L.geometries[q]=f;else if("sphere"===N.type)f=new THREE.SphereGeometry(N.radius,N.widthSegments,N.heightSegments),f.name=q,L.geometries[q]=f;else if("cylinder"===N.type)f=new THREE.CylinderGeometry(N.topRad,N.botRad,N.height,N.radSegs,N.heightSegs),f.name=q,L.geometries[q]=f;else if("torus"===N.type)f=new THREE.TorusGeometry(N.radius,N.tube,N.segmentsR,N.segmentsT),f.name=q,L.geometries[q]=f;else if("icosahedron"===N.type)f=new THREE.IcosahedronGeometry(N.radius,N.subdivisions),f.name=q,L.geometries[q]=f;else if(N.type in this.geometryHandlers){var W=this.geometryHandlers[N.type].loaderObject;W.load(t(N.url,j.urlBaseType),l(q))}else if("embedded"===N.type){var I=j.embeds[N.id],U="";if(I.metadata=j.metadata,I){var V=this.geometryHandlers.ascii.loaderObject,X=V.parse(I,U);p(q)(X.geometry,X.materials)}}var z,J;for(z in j.textures)if(J=j.textures[z],J.url instanceof Array){R+=J.url.length;for(var Y=0;Y<J.url.length;Y++)S.onLoadStart()}else R+=1,S.onLoadStart();w=R;for(z in j.textures){J=j.textures[z],void 0!==J.mapping&&void 0!==THREE[J.mapping]&&(J.mapping=THREE[J.mapping]);var y;if(J.url instanceof Array){for(var Z=J.url.length,K=[],Q=0;Z>Q;Q++)K[Q]=t(J.url[Q],j.urlBaseType);var W=THREE.Loader.Handlers.get(K[0]);null!==W?(y=W.load(K,G(Z)),void 0!==J.mapping&&(y.mapping=J.mapping)):y=THREE.ImageUtils.loadTextureCube(K,J.mapping,G(Z))}else{var $=t(J.url,j.urlBaseType),er=G(1),W=THREE.Loader.Handlers.get($);if(null!==W?y=W.load($,er):(y=new THREE.Texture,W=new THREE.ImageLoader,function(e){W.load($,function(r){e.image=r,e.needsUpdate=!0,er()})}(y)),void 0!==J.mapping&&(y.mapping=J.mapping),void 0!==THREE[J.minFilter]&&(y.minFilter=THREE[J.minFilter]),void 0!==THREE[J.magFilter]&&(y.magFilter=THREE[J.magFilter]),J.anisotropy&&(y.anisotropy=J.anisotropy),J.repeat&&(y.repeat.set(J.repeat[0],J.repeat[1]),1!==J.repeat[0]&&(y.wrapS=THREE.RepeatWrapping),1!==J.repeat[1]&&(y.wrapT=THREE.RepeatWrapping)),J.offset&&y.offset.set(J.offset[0],J.offset[1]),J.wrap){var rr={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==rr[J.wrap[0]]&&(y.wrapS=rr[J.wrap[0]]),void 0!==rr[J.wrap[1]]&&(y.wrapT=rr[J.wrap[1]])}}L.textures[z]=y}var ar,tr,ir;for(ar in j.materials){tr=j.materials[ar];for(ir in tr.parameters)if("envMap"===ir||"map"===ir||"lightMap"===ir||"bumpMap"===ir||"normalMap"===ir||"alphaMap"===ir)tr.parameters[ir]=L.textures[tr.parameters[ir]];else if("shading"===ir)tr.parameters[ir]="flat"===tr.parameters[ir]?THREE.FlatShading:THREE.SmoothShading;else if("side"===ir)tr.parameters[ir]="double"==tr.parameters[ir]?THREE.DoubleSide:"back"==tr.parameters[ir]?THREE.BackSide:THREE.FrontSide;else if("blending"===ir)tr.parameters[ir]=tr.parameters[ir]in THREE?THREE[tr.parameters[ir]]:THREE.NormalBlending;else if("combine"===ir)tr.parameters[ir]=tr.parameters[ir]in THREE?THREE[tr.parameters[ir]]:THREE.MultiplyOperation;else if("vertexColors"===ir)"face"==tr.parameters[ir]?tr.parameters[ir]=THREE.FaceColors:tr.parameters[ir]&&(tr.parameters[ir]=THREE.VertexColors);else if("wrapRGB"===ir){var or=tr.parameters[ir];tr.parameters[ir]=new THREE.Vector3(or[0],or[1],or[2])}else if("normalScale"===ir){var nr=tr.parameters[ir];tr.parameters[ir]=new THREE.Vector2(nr[0],nr[1])}void 0!==tr.parameters.opacity&&tr.parameters.opacity<1&&(tr.parameters.transparent=!0),E=new THREE[tr.type](tr.parameters),E.name=ar,L.materials[ar]=E}for(ar in j.materials)if(tr=j.materials[ar],tr.parameters.materials){for(var sr=[],Q=0;Q<tr.parameters.materials.length;Q++){var lr=tr.parameters.materials[Q];sr.push(L.materials[lr])}L.materials[ar].materials=sr}i(),L.cameras&&j.defaults.camera&&(L.currentCamera=L.cameras[j.defaults.camera]),L.fogs&&j.defaults.fog&&(L.scene.fog=L.fogs[j.defaults.fog]),S.callbackSync(L),d()}};